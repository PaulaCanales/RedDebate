<!DOCTYPE html>
{% load static %}
<html>
	<head>
    <link rel="shortcut icon" type="image/png" href="{% static 'img/RDLogo02.png' %}"/>

    <!--Load the AJAX API google charts-->
      <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
      <link rel="stylesheet" type='text/css' href="{% static '/css/bootstrap.css' %}" >

      <!-- DatePicker -->
      <link rel="stylesheet" href="{% static 'css/datepicker.css' %}"/>
      <script src="{% static 'js/bootstrap-datepicker.js' %}"></script>
      <script src="{% static 'js/bootstrap.js' %}"></script>
      <script src="{% static 'js/functions.js' %}"></script>
      <script>
        $(function() {
          $('.datepicker').datepicker();
        });
      </script>

       <title>RED DE DEBATE</title>
	</head>
<body>
<script type="text/javascript">
  function cambiar_postura(id_debate, postura, porcentaje_f, porcentaje_c){
    console.log("funciona .. hasta aqui!!!!!!!");
       $.ajax({

           url: "{% url 'despliega' 1 %}" ,
           type: 'POST',
           data:{  id : id_debate,
                   postura_debate_ajax: postura,
                   csrfmiddlewaretoken: '{{ csrf_token }}'
                 } ,
                 success: function(data) {
                   document.getElementById('tu_postura').innerHTML = data;
                   console.log(data);
                    if (data == "En Contra"){

                     document.getElementById('bot_ec').style.class = "posturactual"
                     document.getElementById('bot_af').style.class = "postura"

										 document.getElementById('bot_argumento0').style.display = 'block';
										 document.getElementById('bot_argumento1').style.display = 'none';
                   }
                   else{
                     document.getElementById('bot_af').style.class ="posturactual"
                     document.getElementById('bot_ec').style.class ="postura"

										 document.getElementById('bot_argumento1').style.display = 'block';
										 document.getElementById('bot_argumento0').style.display = 'none';
                   }

									 document.getElementById('bot_ec').textContent = "En Contra"+porcentaje_c
									 document.getElementById('bot_af').textContent = "A Favor"+porcentaje_f

                   if (document.getElementById('argumentos')){
                     // document.getElementById('argumentos').style.display = 'block';
                      $("#argumentos").slideDown("slow");
                     {% if num_post_c %}
                           if (data == "En Contra"){
                             document.getElementById('num_postura_contra').innerHTML = {{num_post_c}} ;
                           }
                           else{
                             document.getElementById('num_postura_favor').innerHTML = {{num_post_f}} ;

                           }
                     {% endif %}
                   }
                   else{
                       {% if num_post_c %}
                           if (data == "En Contra"){
                             document.getElementById('num_postura_contra').innerHTML = '<span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span> ' + {{num_post_c}};
                             document.getElementById('num_postura_favor').innerHTML = '<span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> ' + {{num_post_f}} ;
                           }
                           else{
                             document.getElementById('num_postura_favor').innerHTML = '<span class="glyphicon glyphicon-thumbs-up" aria-hidden="true"></span> ' + {{num_post_c}} ;
                             document.getElementById('num_postura_contra').innerHTML = '<span class="glyphicon glyphicon-thumbs-down" aria-hidden="true"></span> ' + {{num_post_f}} ;
                           }
                       {% else %}
                       var relleno =0;
                       {% endif %}



                   }
                 },
                 failure: function(data) {
                     alert('Error de conexión');
                 },
                 crossDomain: true
             });
           }

  function valorar(argumento, id_div, val, opcionusr){
     console.log("llega al valorar");
     console.log(argumento);
     $.ajax({
       url: "{% url 'despliega' 15 %}" ,
       type: 'POST',
       data:{  id_arg : argumento,
         opcion: opcionusr,
         csrfmiddlewaretoken: '{{ csrf_token }}'} ,
         success: function(data) { // id
           document.getElementById(id_div).innerHTML = data;
           document.getElementById(id_div).style.display = "none";
           document.getElementById(val).innerHTML = data;
           document.getElementById(argumento).style.display = 'block';
           console.log("div: ");
           console.log(id_div); },
         failure: function(data) {
           alert('Error de conexión'); },
           crossDomain: true });
   }

  $(document).ready(
    function(){
      try{
        document.getElementById("dbt_abiertos").click(); }
      catch(err){}
    });

  $(document).ready(function() {
    {% if debate.largo %}
    var text_max = {{ debate.largo }};
    {% else %}
    var text_max = 0;
    {% endif %}
    $('#textarea_feedback1').html(text_max + ' caracteres restantes');
    $('#textarea_feedback2').html(text_max + ' caracteres restantes');
    $('#textarea_feedback3').html(text_max + ' caracteres restantes');
    $('#textarea_feedback4').html(text_max + ' caracteres restantes');
    $('#textarea_feedback5').html(text_max + ' caracteres restantes');
    $('#textarea_feedback6').html(text_max + ' caracteres restantes');

    $('#textarea6').keyup(function() {
      var text_length = $('#textarea6').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback6').html(text_remaining + ' caracteres restantes'); });

    $('#textarea5').keyup(function() {
      var text_length = $('#textarea5').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback5').html(text_remaining + ' caracteres restantes'); });

    $('#textarea4').keyup(function() {
      var text_length = $('#textarea4').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback4').html(text_remaining + ' caracteres restantes'); });

    $('#textarea3').keyup(function() {
      var text_length = $('#textarea3').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback3').html(text_remaining + ' caracteres restantes'); });

    $('#textarea2').keyup(function() {
      var text_length = $('#textarea2').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback2').html(text_remaining + ' caracteres restantes'); });

    $('#textarea1').keyup(function() {
      var text_length = $('#textarea1').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback1').html(text_remaining + ' caracteres restantes'); });
  });

  $(document).ready(function() {
    {% if debate.largo %}
    var text_max = {{ debate.largo }};
    {% else %}
    var text_max = 0;
    {% endif %}
    $('#textarea_feedback1').html(text_max + ' caracteres restantes');
    $('#textarea_feedback2').html(text_max + ' caracteres restantes');
    $('#textarea_feedback3').html(text_max + ' caracteres restantes');
    $('#textarea_feedback4').html(text_max + ' caracteres restantes');
    $('#textarea_feedback5').html(text_max + ' caracteres restantes');
    $('#textarea_feedback6').html(text_max + ' caracteres restantes');

    $('#textarea6').keyup(function() {
      var text_length = $('#textarea6').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback6').html(text_remaining + ' caracteres restantes'); });

    $('#textarea5').keyup(function() {
      var text_length = $('#textarea5').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback5').html(text_remaining + ' caracteres restantes'); });

    $('#textarea4').keyup(function() {
      var text_length = $('#textarea4').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback4').html(text_remaining + ' caracteres restantes'); });

    $('#textarea3').keyup(function() {
      var text_length = $('#textarea3').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback3').html(text_remaining + ' caracteres restantes'); });

    $('#textarea2').keyup(function() {
      var text_length = $('#textarea2').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback2').html(text_remaining + ' caracteres restantes'); });

    $('#textarea1').keyup(function() {
      var text_length = $('#textarea1').val().length;
      var text_remaining = text_max - text_length;
      $('#textarea_feedback1').html(text_remaining + ' caracteres restantes'); });
  });

  google.charts.load('current', {'packages':['corechart','bar']});

  // Set a callback to run when the Google Visualization API is loaded.
  google.charts.setOnLoadCallback(drawChart_argumento);
  google.charts.setOnLoadCallback(drawChart_postura);
  google.charts.setOnLoadCallback(drawStuff);

  function drawStuff() {
    {% if argF.0 %}
      var val_argF1 = {{ argF.0.2}};
    {% else %}
      var val_argF1 =0;
    {% endif %}

    {% if argF.1 %}
      var val_argF2 = {{ argF.1.2 }};
    {% else %}
      var val_argF2 =0;
    {% endif %}

    {% if argC.0 %}
      var val_argC1 = {{ argC.0.2 }};
    {% else %}
      var val_argC1 =0;
    {% endif %}

    {% if argC.1 %}
      var val_argC2 = {{ argC.1.2 }};
    {% else %}
      var val_argC2 =0;
    {% endif %}

    var data = new google.visualization.arrayToDataTable([
      ['Valoración', 'A Favor','En Contra'],
      ['1º Mejor Valorado', val_argF1 ,val_argC1],
      ['2º Mejor Valorado', val_argF2  , val_argC2], ]);

    var options = {
      width: 800,
      chart: {
        title: 'Valoración',
        subtitle: 'Comparación de los argumentos a favor y en contra más valorados' },
        bars: 'horizontal', // Required for Material Bar Charts.
        series: {
          0: { color: '18BD9B'}, // Bind series 0 to an axis named 'distance'.
          1: { color: '2D3E50'} // Bind series 1 to an axis named 'brightness'.
        },
        axes: {
          x: {
          argumento: {label: 'Valoración'}, // Bottom x-axis.
          valoracion: {side: 'top', label: 'magnitud'} // Top x-axis.
          }
        }
      };

    var chart = new google.charts.Bar(document.getElementById('chart_arg_val'));
    chart.draw(data, options);
   };

     // Callback that creates and populates a data table,
     // instantiates the pie chart, passes in the data and
     // draws it.
     function drawChart_argumento() {

       {% if argF %}
           var cant_argF = {{ argF|length }};
       {% else %}
          var cant_argF =0;
       {% endif %}
       {% if argC %}
           var cant_argC = {{ argC|length }};
       {% else %}
          var cant_argC =0;
       {% endif %}
       console.log("cant_argF");
       console.log(cant_argF);
       // Create the data table.
       var data = new google.visualization.DataTable();
       data.addColumn('string', 'Topping');
       data.addColumn('number', 'Slices');
       data.addRows([
         ['A Favor', cant_argF],
         ['En Contra', cant_argC],
       ]);

       // Set chart options
       var options = {'title':'Cantidad de Argumentos en el Debate',
                      'width':400,
                      'height':300,
                      'colors': ['#18BD9B', '#2D3E50']};

       // Instantiate and draw our chart, passing in some options.
       var chart = new google.visualization.PieChart(document.getElementById('chart_div'));
       chart.draw(data, options);
     };

     function drawChart_postura() {

       {% if num_post_f > 0 %}
         var cant_postF = {{ num_post_f }};
       {% else %}
         var cant_postF =0;
       {% endif %}
       {% if num_post_c > 0 %}
         var cant_postC = {{ num_post_c }};
       {% else %}
         var cant_postC =0;
       {% endif %}
       console.log("cant_postF");
       console.log(cant_postF);
       // Create the data table.
       var data = new google.visualization.DataTable();
       data.addColumn('string', 'Topping');
       data.addColumn('number', 'Slices');
       data.addRows([
         ['A Favor', cant_postF],
         ['En Contra', cant_postC],
       ]);

       // Set chart options
       var options = {'title':'Cantidad de Posturas en el Debate',
                      'width':400,
                      'height':300,
                      'colors': ['#18BD9B', '#2D3E50']};

       // Instantiate and draw our chart, passing in some options.
       var chart = new google.visualization.PieChart(document.getElementById('chart_div2'));
       chart.draw(data, options);
     };
</script>

	<div class="page-header">
	<!--barra superior-->
	    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a href="{% url 'index' %}"><IMG SRC="{% static 'img/RDLogo03.png' %}" height='65' ALT="RedDebateLogo"></a>
            </div>
            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="{% url 'index' %}">Todos los Debates</a>
                    </li>

                    <li>
                        <a href="{% url 'perfil' %}">Perfil</a>
                    </li>


                </ul>
            </div>



            <!-- /.navbar-collapse -->
        </div>


        <!-- /.container -->
    </nav>



    </div>
     <div align="right" style="padding-right: 30px;">
     </br>
        {{ user.get_full_name }}
    </br>
        <a href="{% url 'user-logout' %}"> Cerrar Sesión</a>
    </div>
	{% block content %}
	{% endblock content %}

  <div class="container">

    <div align="right">
      <button onclick=window.open("http://146.83.216.163/mantisbt/login_page.php") type="submit" class="btn btn-index" > Reportar Problema</button>
    </div>
  </div>
	</body>
</html>
